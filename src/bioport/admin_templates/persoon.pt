<html metal:use-macro="context/@@admin_template/macros/master">
<div metal:fill-slot="content"
	class="person_edit"
    tal:define="
    	merged_bio view/merged_biography;
    	bioport_bio view/bioport_biography; 
    	" 
    >
<script>
show = function(element_id) {
	el = document.getElementById(element_id);
	if (el) {el.style.display='';}
}

hide = function(element_id) {
	el = document.getElementById(element_id);
	if (el) {el.style.display='none'};
}


</script>
<h1>Bewerk gegevens van <em tal:content="python:view.person.naam().volledige_naam()" /></h1>
<p>
De gegevens in het formulier zijn de gegevens zoals ze op het biografisch portaal worden 
<a tal:attributes="href python:view.url(context.__parent__, 'persoon', data={'bioport_id':view.bioport_id})">getoond</a>. 
</p>
<p>
De gegevens zijn grijs als ze uit de bronnen-publikaties komen, zwart als ze zijn ingevoerd door de medewerkers van het biografisch portaal.
</p>

<form action="." tal:attributes="action request/URL" method="get"
      class="edit-form" >
      <input type="hidden" name="bioport_id" tal:attributes="value python:view.bioport_id" />
<table>
    <tr>
        <th>bioport identifier</th>
        <td class="bioport" tal:content="view/person/get_bioport_id" />
    </tr>
    <tr metal:define-macro="separator" class="separator"><td colspan="3"><hr></td></tr>
    <tr tal:define="namen view/get_bioport_namen"
    	tal:repeat="idx python:range(len(namen))">
    	<th><span tal:condition="python:idx == 0" >namen</span></th>
    	<td tal:define="naam python:namen[idx]"
		    tal:attributes="class python:view.get_bioport_namen() and 'bioport' or 'merged'"
    		tal:content="naam/volledige_naam" />
		<td >
			<a tal:attributes="href python:view.url('changename', data={'bioport_id':view.bioport_id, 'idx':idx})">
			verander
			</a>
			<span tal:condition="python:len(namen) > 1">
			| <a href="" onclick="alert('nog niet geimplementeerd')"> verwijder </a>
			| <a href="" onclick="alert('nog niet geimplementeerd')"> omhoog </a>
			| <a href="" onclick="alert('nog niet geimplementeerd')"> omlaag </a>
			</span>
		</td>    
   	</tr>

   		
    <tr tal:condition="not:view/get_bioport_namen" 
     tal:define="namen view/get_non_bioport_namen"
    	tal:repeat="idx python:range(len(namen))">

    	<th><span tal:condition="python:idx == 0" >namen</span></th>
    	<td tal:define="naam python:namen[idx]"
		    tal:attributes="class python:view.get_bioport_namen() and 'bioport' or 'merged'"
    		tal:content="naam/volledige_naam" />
		<td >
			<a tal:attributes="href python:view.url('changename', data={'bioport_id':view.bioport_id, 'idx':idx})">
			verander
			</a>
		</td>    

   	</tr>
   	
   	<tr>
   		<th></th>
   		<td>
			<a tal:attributes="href python:view.url('changename', data={'bioport_id':view.bioport_id})">
			voeg een naam toe
			</a>
		</td>    
	</tr>
   	<tr metal:use-macro="template/macros/separator" /> 
    <!-- geboortedatum -->
    <span tal:omit-tag=""
    	 tal:define="title string:geboorte;
    	 	prefix string:birth;"
    	 >
    <div metal:define-macro="event_form"
	    tal:define="
        		event python:view.get_event(prefix);
    	show_exact python:(not event) or (event.when or not (event.notAfter or event.notBefore or event.date_text));
		show_approx python:event and (event.notAfter or event.notBefore or event.date_text) and True;
        	">
    <tr  tal:attributes="id prefix" > 
        <th tal:content="title">geboorte</th>
  		<td> </td>
       <td>
	        <span tal:replace="structure python:view.actions.byname['form.actions.save_event_%s' % prefix].render()" />
        </td> 
     </tr>
     <tr tal:attributes="
     	id string:${prefix}_exact;
style python:not show_exact and 'display:none'">
     	<th class="sublabel">datum</th>
        <td  tal:attributes="class python:view.status_value('geboortedatum')"
        	tal:define="ymd event/when_ymd | nothing">
 	
 		<span metal:define-macro="date_widget" tal:omit-tag="">

        	<select tal:attributes="name string:${prefix}_d">
        		<option />
        		<option 
	        		tal:repeat="option python:range(1, 32)" 
	        		tal:attributes="selected python:ymd and ymd[2] == option"
	        		tal:content="option"
        		/>
        	</select>
        	<select tal:attributes="name string:${prefix}_m">
         		<option>
        		<option 
	        		tal:repeat="option python:range(1, 13)" 
	        		tal:attributes="
			        		selected python:ymd and ymd[1] == option;
	        			value option;"
	        		tal:content="python:view.maanden()[option-1]"
        		/>
        	</select>
        	<input  type="text" size="4" style="width:4"
        		tal:attributes="name string:${prefix}_y;
        			value python:ymd and ymd[0] or ''" />
		
		</span>	
		<p>
    	<a href="" 
    		tal:attributes="id string:${prefix}_button_on;
    			OnClick string:
    				show('${prefix}_notBefore');;
    				show('${prefix}_notAfter');;
    				show('${prefix}_text');;
    				hide('${prefix}_exact');;
    				hide('${prefix}_button_on');;
    				return false;;">exacte datum niet bekend</a>
	    </td>	
	 </tr>
	<tr tal:attributes="id string:${prefix}_notBefore;
			style python:not show_approx and 'display:none';
			" >	 
	

		<th class="sublabel">na</th> 
		<td  tal:define="
				prefix string:${prefix}_notBefore;
				ymd event/notBefore_ymd | nothing">
				<span metal:use-macro="template/macros/date_widget"></span>
		</td>
	</tr>
	<tr tal:attributes="id string:${prefix}_notAfter;
			style python:not show_approx and 'display:none';
			" >	 

		<th class="sublabel">v&oacute;&oacute;r</th> 
		<td>	

				<span  tal:define="
					prefix string:${prefix}_notAfter;
					ymd event/notAfter_ymd | nothing">
					<span metal:use-macro="template/macros/date_widget" />
				</span>	
		</td>
	</tr>
	<tr tal:attributes="id string:${prefix}_text;
			style python:not show_approx and 'display:none';
			" >	 

		<th class="sublabel">tekst</th> 
	
		<td>
			<input type="tekst" 
				tal:attributes="
					name string:${prefix}_text;
					value event/date_text | nothing" />
			<p>
        		
        	<a href="" 
        		tal:attributes="id string:${prefix}_approx_button_off;
		   			OnClick string:
						hide('${prefix}_notBefore');;
						hide('${prefix}_notAfter');;
						hide('${prefix}_text');;
						show('${prefix}_exact');;
						show('${prefix}_button_on');;
						hide('${prefix}_button_off');;
						return false;;">exacte datum bekend</a>

	        </td>

    </tr>

   	
    <!--  plaats -->
    <tr> 
        <th class="sublabel">plaats</th>
        <td tal:attributes="class python:view.status_value('geboorteplaats')">
        	<input type="tekst"  
	        	tal:attributes="name string:${prefix}_place;
		        	value event/place | nothing" />
        </td>

    </tr>
   </div> 
   	</span>	 
   	<tr metal:use-macro="template/macros/separator" /> 
   	
    <!-- dood -->
   	<span tal:omit-tag=""
   		 tal:define="
   		 	title string:dood;
   		 	prefix string:death;">
   		 <tr metal:use-macro="template/macros/event_form" />
	 </span>
  

   	<tr metal:use-macro="template/macros/separator" /> 

   	
  
   	<span tal:omit-tag=""
   		 tal:define="
   		 	title string:doop;
   		 	prefix string:baptism;">
   		 <tr metal:use-macro="template/macros/event_form"  />
	 </span>
   	
   	<tr metal:use-macro="template/macros/separator" /> 
 
   	<span tal:omit-tag=""
   		 tal:define="
   		 	title string:begrafenis;
   		 	prefix string:funeral;">
   		 <tr metal:use-macro="template/macros/event_form"  />
	 </span>
	    	<tr metal:use-macro="template/macros/separator" /> 
    <tr>
   	<th />
   	<td>
        <span tal:replace="structure python:view.actions.byname['form.actions.save_everything'].render()" />
	</td> 
    </tr>
</table>
</form>




<div class="info">
<div tal:repeat="bio view/person/get_biographies">
<h2>Bron: 
	<a tal:attributes="href python:bio.get_value('url_biografie')" >
		<span tal:replace="python:bio.get_source().id"></span> - <span tal:replace="python:bio.get_source().description"></span>
	</a>
</h2>
<table >
	<tr>
		<th>Namen</th>
		<td>
			<div tal:repeat="naam python:bio.get_namen()" tal:content="naam/volledige_naam"></div>	
		</td>
	</tr>
	<tal:block repeat="event2 python:[('geboorte', 'birth'), ('dood', 'death'), ('doop', 'baptism'), ('begrafenis', 'funeral')]" >
	<span 
		tal:define="event python:view.get_event(event2[1], biography=bio);
			title python:event2[0]"
		tal:condition="python:event"> 
		<tr tal:condition="event/when">
			<th tal:content="python:'%s-datum' % title" />
			<td tal:content="event/when_formatted">
			</td>
		</tr> 
		<tr tal:condition="event/notBefore">
			<th tal:content="python:'%s-na' % title" />
			<td tal:content="event/notBefore_formatted">
			</td>
		</tr> 
		<tr tal:condition="event/notAfter">
			<th tal:content="python:'%s-voor' % title" />
			<td tal:content="event/notAfter_formatted">
			</td>
		</tr> 
		<tr tal:condition="event/date_text">
			<th tal:content="python:'%s-datum_tekst' % title" />
			<td tal:content="event/date_text"> </td>
		</tr> 
		<tr tal:condition="event/place">
			<th tal:content="python:'%s-plaats' % title" />
			<td tal:content="event/place"> </td>
		</tr> 
		</span>
	</tal:block>
	
	<tr tal:condition="python:bio.get_value('tekst')">
		<th>Tekst</th>
		<td>
			<span tal:replace="python:bio.get_value('tekst')" />
		</td>
	</tr>	
	<tr tal:condition="python:bio.record.timestamp">
		<th>laatst veranderd</th>
		<td tal:content="python:bio.record.timestamp" ></td>
	</tr>
	</table>
</div>
</div>
</div>
</html>
